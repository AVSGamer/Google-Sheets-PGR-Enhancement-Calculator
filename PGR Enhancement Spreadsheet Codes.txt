*Use VS Studio Code or any Text Editor that doesn't wrap text lines.
[Table of Contents]                                 [Line #]
General Formulas                                    Line 11
Substitution of Formulas into Use Cases             Line 28
Codes of the Calculator                             Line 61
OC Level Label Codes                                Line 195
Link to the Project                                 Line 319

EXP amount needed = Accum. EXP of Target Level - (Accum. EXP of Current Level + Current EXP at Current Level)

[[General Formulas]]
//EXP From Current OC & Level to Current OC & Level
NeededEXP = (OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)
//EXP From Current OC & Level to Max Level in that OC Level
NeededEXP = (OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)
//EXP From Lower OC Level to Max Level in Current OC Level
NeededEXP = (OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))
//EXP From Lower OC Level to Current OC Level as Target
NeededEXP = (OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))

//Get amount of 4*:
IF(NeededEXP>0,FLOOR(NeededEXP/300,1),0)
//Get amount of 3*:
IF(NeededEXP-(IF(NeededEXP>0,FLOOR(NeededEXP/300,1),0)*300)=0,0,IF(MOD(NeededEXP-(IF(NeededEXP>0,FLOOR(NeededEXP/300,1),0)*300),100)>50,FLOOR((NeededEXP-(IF(NeededEXP>0,FLOOR(NeededEXP/300,1),0)*300))/100,1)+1,FLOOR((NeededEXP-(IF(NeededEXP>0,FLOOR(NeededEXP/300,1),0)*300))/100,1)))
//Get amount of 2*:
IF((NeedexEXP-((IF(NeededEXP>0,FLOOR(NeededEXP/300,1),0))*300)-((IF(NeededEXP-(IF(NeededEXP>0,FLOOR(NeededEXP/300,1),0)*300)=0,0,IF(MOD(NeededEXP-(IF(NeededEXP>0,FLOOR(NeededEXP/300,1),0)*300),100)>50,FLOOR((NeededEXP-(IF(NeededEXP>0,FLOOR(NeededEXP/300,1),0)*300))/100,1)+1,FLOOR((NeededEXP-(IF(NeededEXP>0,FLOOR(NeededEXP/300,1),0)*300))/100,1))))*100))<=0,0,1)

[[Substitution of Formulas into Use Cases]]
////FROM CURR OC & LVL TO CURR OC & LVL
//Get amount of 4*:
IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))
//Get amount of 3*:
IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)))
//Get amount of 2*:
IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1)

////FROM CURR OC & LVL TO CURR OC & MAX LVL
//Get amount of 4*:
IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))
//Get amount of 3*:
IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)))
//Get amount of 2*:
IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1)

////FROM LOWER OC LEVEL TO HIGHER OC LEVEL
//Get amount of 4*:
IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))/300,1),0))
//Get amount of 3*:
IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))/300,1),0)*300))/100,1)))
//Get amount of 2*:
IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1)

////FROM LOWER OC LEVEL TO CURRENT OC LEVEL AS TARGET
//Get amount of 4*:
IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))/300,1),0))
//Get amount of 3*:
IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)))
//Get amount of 2*:
IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=0)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1)

[[Codes of the Calculator]]
//Copy the code below to the cell below the "4*" Label in the correct OC Level Section then reselect that cell and copy it to the cells below "3*" and "2*".
//Basically the code for cells below the 4*,3*, & 2* Labels in the same OC Level are all the same code with very minor differences due to how copying formulas with non-absolute references in spreadsheets works.
[OC Level 0]
=IF(AND($C$6=0,$C$9=0),
    SWITCH(C14,
        "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),
        "3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),
        "4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)),
    IF($C$6>0,0,
        SWITCH(C14,
        "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),
        "3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),
        "4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))
    )
)
//Compressed version of above code.
=IF(AND($C$6=0,$C$9=0),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)),IF($C$6>0,0,SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=0)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))))

[OC Level 1]
=IF(AND($C$6=1,$C$9=1),
    SWITCH(C14,
        "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),
        "3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),
        "4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)),
    IF($C$6>1,0,
        IF(AND($C$6<1,$C$9>1),
            SWITCH(C14,
                "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),
                "3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300))/100,1))),
                "4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)),
            IF(AND($C$6<1,$C$9=1),
                SWITCH(C14,
                    "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),
                    "3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))),
                    "4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)),
                IF(AND($C$6=1,$C$9>1),
                    SWITCH(C14,
                        "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),
                        "3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),
                        "4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))
                    ,0
                )
            )
        )
    )
)
//Compressed version of above code.
=IF(AND($C$6=1,$C$9=1),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)),IF($C$6>1,0,IF(AND($C$6<1,$C$9>1),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1))/300,1),0)),IF(AND($C$6<1,$C$9=1),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=1)),$C$10-1,3,1,1))/300,1),0)),IF(AND($C$6=1,$C$9>1),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=1)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)),0)))))

[OC Level 2]
=IF(AND($C$6=2,$C$9=2),
    SWITCH(C14,
        "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),
        "3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),
        "4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)),
    IF($C$6>2,0,
        IF(AND($C$6<2,$C$9>2),
            SWITCH(C14,
                "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),
                "3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300))/100,1))),
                "4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)),
            IF(AND($C$6<2,$C$9=2),
                SWITCH(C14,
                    "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),
                    "3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))),
                    "4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)),
                IF(AND($C$6=2,$C$9>2),
                    SWITCH(C14,
                        "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),
                        "3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),
                        "4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))
                    ,0
                )
            )
        )
    )
)
//Compressed version of above code.
=IF(AND($C$6=2,$C$9=2),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)),IF($C$6>2,0,IF(AND($C$6<2,$C$9>2),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1))/300,1),0)),IF(AND($C$6<2,$C$9=2),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=2)),$C$10-1,3,1,1))/300,1),0)),IF(AND($C$6=2,$C$9>2),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=2)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)),0)))))

[OC Level 3]
=IF(AND($C$6=3,$C$9=3),
    SWITCH(C14,
        "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),
        "3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),
        "4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)),
    IF($C$6>3,0,
        IF(AND($C$6<3,$C$9>3),
            SWITCH(C14,
                "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),
                "3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300))/100,1))),
                "4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)),
            IF(AND($C$6<3,$C$9=3),
                SWITCH(C14,
                    "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),
                    "3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))),
                    "4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)),
                IF(AND($C$6=3,$C$9>3),
                    SWITCH(C14,
                        "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),
                        "3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),
                        "4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))
                    ,0
                )
            )
        )
    )
)
//Compressed version of above code.
=IF(AND($C$6=3,$C$9=3),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)),IF($C$6>3,0,IF(AND($C$6<3,$C$9>3),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1))/300,1),0)),IF(AND($C$6<3,$C$9=3),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=3)),$C$10-1,3,1,1))/300,1),0)),IF(AND($C$6=3,$C$9>3),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),FILTER($X:$X,$V:$V=$C$5,$W:$W=3)-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)),0)))))

[OC Level 4]
=IF(AND($C$6=4,$C$9=4),
    SWITCH(C14,
        "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),
        "3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),
        "4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)),
    IF($C$6>4,0,
        IF(AND($C$6<4,$C$9>4),
            0,
            IF(AND($C$6<4,$C$9=4),
                SWITCH(C14,
                    "2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),
                    "3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))),
                    "4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)),
                IF(AND($C$6=4,$C$9>4),0,0)
            )
        )
    )
)
//Compressed version of above code.
=IF(AND($C$6=4,$C$9=4),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)-(IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$10-1,3,1,1)-OFFSET(INDIRECT($AB$1&"!"&$AB$2),$C$7-1,3,1,1)+$C$8)/300,1),0)),IF($C$6>4,0,IF(AND($C$6<4,$C$9>4),0,IF(AND($C$6<4,$C$9=4),SWITCH(C14,"2*",IF(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0))*300)-((IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))))*100))<=0,0,1),"3*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300)=0,0,IF(MOD((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300),100)>50,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300))/100,1)+1,FLOOR(((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))-(IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)*300))/100,1))),"4*",IF((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))>0,FLOOR((OFFSET(INDIRECT($AB$1&"!"&FILTER($Y:$Y,$V:$V=$C$5,$W:$W=4)),$C$10-1,3,1,1))/300,1),0)),IF(AND($C$6=4,$C$9>4),0,0)))))

[[OC Level Label Codes]]
[OC Level 0 Label Code]
=IF(AND(C6=0,C9=0),
    "OC 0 - Lv."&C7&" to OC 0 - Lv."&C10,
    IF(C6>0,
        "OC 0 - Lv.x to OC 0 - Lv.x+",
        SWITCH(C5,
        "2*","OC 0 - Lv."&C7&" to OC 0 - Lv.10",
        "3*","OC 0 - Lv."&C7&" to OC 0 - Lv.15",
        "4*","OC 0 - Lv."&C7&" to OC 0 - Lv.20",
        "5*","OC 0 - Lv."&C7&" to OC 0 - Lv.25",
        "6*","OC 0 - Lv."&C7&" to OC 0 - Lv.25")))
//Compressed version of above code.
=IF(AND(C6=0,C9=0),"OC 0 - Lv."&C7&" to OC 0 - Lv."&C10,IF(C6>0,"OC 0 - Lv.x to OC 0 - Lv.x+",SWITCH(C5,"2*","OC 0 - Lv."&C7&" to OC 0 - Lv.10","3*","OC 0 - Lv."&C7&" to OC 0 - Lv.15","4*","OC 0 - Lv."&C7&" to OC 0 - Lv.20","5*","OC 0 - Lv."&C7&" to OC 0 - Lv.25","6*","OC 0 - Lv."&C7&" to OC 0 - Lv.25")))

[OC Level 1 Label Code]
=IF(AND(C6=1,C9=1),
    SWITCH(C5,
    "2*","2* does not have OC 1.","3*","OC 1 - Lv."&C7&" to OC 1 - Lv."&C10,
    "4*","OC 1 - Lv."&C7&" to OC 1 - Lv."&C10,"5*","OC 1 - Lv."&C7&" to OC 1 - Lv."&C10,
    "6*","OC 1 - Lv."&C7&" to OC 1 - Lv."&C10),
    IF(C6>1,
        SWITCH(C5,
        "2*","2* does not have OC 1.","OC 1 - Lv.x to OC 1 - Lv.x+"),
        IF(AND(C6<1,C9>1),
            SWITCH(C5,
            "2*","2* does not have OC 1.","3*","OC 1 - Lv.1 to OC 1 - Lv.20",
            "4*","OC 1 - Lv.1 to OC 1 - Lv.25","5*","OC 1 - Lv.1 to OC 1 - Lv.30",
            "6*","OC 1 - Lv.1 to OC 1 - Lv.30","OC 1 - Lv.x to OC 1 - Lv.x+"),
            IF(AND(C6<1,C9=1),
                SWITCH(C5,
                "2*","2* does not have OC 1.","3*","OC 1 - Lv.1 to OC 1 - Lv."&C10,
                "4*","OC 1 - Lv.1 to OC 1 - Lv."&C10,"5*","OC 1 - Lv.1 to OC 1 - Lv."&C10,
                "6*","OC 1 - Lv.1 to OC 1 - Lv."&C10,"OC 1 - Lv.x to OC 1 - Lv.x+"),
                IF(AND(C6=1,C9>1),
                    SWITCH(C5,
                    "2*","2* does not have OC 1.","3*","OC 1 - Lv."&C7&" to OC 1 - Lv.20",
                    "4*","OC 1 - Lv."&C7&" to OC 1 - Lv.25","5*","OC 1 - Lv."&C7&" to OC 1 - Lv.30",
                    "6*","OC 1 - Lv."&C7&" to OC 1 - Lv.30","OC 1 - Lv.x to OC 1 - Lv.x+"),
                    SWITCH(C5,
                    "2*","2* does not have OC 1.","OC 1 - Lv.x to OC 1 - Lv.x+")))))
//Compressed version of above code.
=IF(AND(C6=1,C9=1),SWITCH(C5,"2*","2* does not have OC 1.","3*","OC 1 - Lv."&C7&" to OC 1 - Lv."&C10,"4*","OC 1 - Lv."&C7&" to OC 1 - Lv."&C10,"5*","OC 1 - Lv."&C7&" to OC 1 - Lv."&C10,"6*","OC 1 - Lv."&C7&" to OC 1 - Lv."&C10),IF(C6>1,SWITCH(C5,"2*","2* does not have OC 1.","OC 1 - Lv.x to OC 1 - Lv.x+"),IF(AND(C6<1,C9>1),SWITCH(C5,"2*","2* does not have OC 1.","3*","OC 1 - Lv.1 to OC 1 - Lv.20","4*","OC 1 - Lv.1 to OC 1 - Lv.25","5*","OC 1 - Lv.1 to OC 1 - Lv.30","6*","OC 1 - Lv.1 to OC 1 - Lv.30","OC 1 - Lv.x to OC 1 - Lv.x+"),IF(AND(C6<1,C9=1),SWITCH(C5,"2*","2* does not have OC 1.","3*","OC 1 - Lv.1 to OC 1 - Lv."&C10,"4*","OC 1 - Lv.1 to OC 1 - Lv."&C10,"5*","OC 1 - Lv.1 to OC 1 - Lv."&C10,"6*","OC 1 - Lv.1 to OC 1 - Lv."&C10,"OC 1 - Lv.x to OC 1 - Lv.x+"),IF(AND(C6=1,C9>1),SWITCH(C5,"2*","2* does not have OC 1.","3*","OC 1 - Lv."&C7&" to OC 1 - Lv.20","4*","OC 1 - Lv."&C7&" to OC 1 - Lv.25","5*","OC 1 - Lv."&C7&" to OC 1 - Lv.30","6*","OC 1 - Lv."&C7&" to OC 1 - Lv.30","OC 1 - Lv.x to OC 1 - Lv.x+"),SWITCH(C5,"2*","2* does not have OC 1.","OC 1 - Lv.x to OC 1 - Lv.x+")))))

[OC Level 2 Label Code]
=IF(AND(C6=2,C9=2),
    SWITCH(C5,
    "2*","2* does not have OC 2.","3*","OC 2 - Lv."&C7&" to OC 2 - Lv."&C10,
    "4*","OC 2 - Lv."&C7&" to OC 2 - Lv."&C10,"5*","OC 2 - Lv."&C7&" to OC 2 - Lv."&C10,
    "6*","OC 2 - Lv."&C7&" to OC 2 - Lv."&C10),
    IF(C6>2,
        SWITCH(C5,
        "2*","2* does not have OC 2.","OC 2 - Lv.x to OC 2 - Lv.x+"),
        IF(AND(C6<2,C9>2),
            SWITCH(C5,
            "2*","2* does not have OC 2.","3*","OC 2 - Lv.1 to OC 2 - Lv.25",
            "4*","OC 2 - Lv.1 to OC 2 - Lv.30","5*","OC 2 - Lv.1 to OC 2 - Lv.35",
            "6*","OC 2 - Lv.1 to OC 2 - Lv.35","OC 2 - Lv.x to OC 2 - Lv.x+"),
            IF(AND(C6<2,C9=2),
                SWITCH(C5,
                "2*","2* does not have OC 2.","3*","OC 2 - Lv.1 to OC 2 - Lv."&C10,
                "4*","OC 2 - Lv.1 to OC 2 - Lv."&C10,"5*","OC 2 - Lv.1 to OC 2 - Lv."&C10,
                "6*","OC 2 - Lv.1 to OC 2 - Lv."&C10,"OC 2 - Lv.x to OC 2 - Lv.x+"),
                IF(AND(C6=2,C9>2),
                    SWITCH(C5,
                    "2*","2* does not have OC 2.","3*","OC 2 - Lv."&C7&" to OC 2 - Lv.25",
                    "4*","OC 2 - Lv."&C7&" to OC 2 - Lv.30","5*","OC 2 - Lv."&C7&" to OC 2 - Lv.35",
                    "6*","OC 2 - Lv."&C7&" to OC 2 - Lv.35","OC 2 - Lv.x to OC 2 - Lv.x+"),
                    SWITCH(C5,
                    "2*","2* does not have OC 2.","OC 2 - Lv.x to OC 2 - Lv.x+")))))
//Compressed version of above code.
=IF(AND(C6=2,C9=2),SWITCH(C5,"2*","2* does not have OC 2.","3*","OC 2 - Lv."&C7&" to OC 2 - Lv."&C10,"4*","OC 2 - Lv."&C7&" to OC 2 - Lv."&C10,"5*","OC 2 - Lv."&C7&" to OC 2 - Lv."&C10,"6*","OC 2 - Lv."&C7&" to OC 2 - Lv."&C10),IF(C6>2,SWITCH(C5,"2*","2* does not have OC 2.","OC 2 - Lv.x to OC 2 - Lv.x+"),IF(AND(C6<2,C9>2),SWITCH(C5,"2*","2* does not have OC 2.","3*","OC 2 - Lv.1 to OC 2 - Lv.25","4*","OC 2 - Lv.1 to OC 2 - Lv.30","5*","OC 2 - Lv.1 to OC 2 - Lv.35","6*","OC 2 - Lv.1 to OC 2 - Lv.35","OC 2 - Lv.x to OC 2 - Lv.x+"),IF(AND(C6<2,C9=2),SWITCH(C5,"2*","2* does not have OC 2.","3*","OC 2 - Lv.1 to OC 2 - Lv."&C10,"4*","OC 2 - Lv.1 to OC 2 - Lv."&C10,"5*","OC 2 - Lv.1 to OC 2 - Lv."&C10,"6*","OC 2 - Lv.1 to OC 2 - Lv."&C10,"OC 2 - Lv.x to OC 2 - Lv.x+"),IF(AND(C6=2,C9>2),SWITCH(C5,"2*","2* does not have OC 2.","3*","OC 2 - Lv."&C7&" to OC 2 - Lv.25","4*","OC 2 - Lv."&C7&" to OC 2 - Lv.30","5*","OC 2 - Lv."&C7&" to OC 2 - Lv.35","6*","OC 2 - Lv."&C7&" to OC 2 - Lv.35","OC 2 - Lv.x to OC 2 - Lv.x+"),SWITCH(C5,"2*","2* does not have OC 2.","OC 2 - Lv.x to OC 2 - Lv.x+")))))

[OC Level 3 Label Code]
=IF(AND(C6=3,C9=3),
    SWITCH(C5,
    "2*","2* does not have OC 3.","3*","3* does not have OC 3.",
    "4*","OC 3 - Lv."&C7&" to OC 3 - Lv."&C10,"5*","OC 3 - Lv."&C7&" to OC 3 - Lv."&C10,
    "6*","OC 3 - Lv."&C7&" to OC 3 - Lv."&C10),
    IF(C6>3,
        SWITCH(C5,
        "2*","2* does not have OC 3.","3*","3* does not have OC 3.","OC 3 - Lv.x to OC 3 - Lv.x+"),
        IF(AND(C6<3,C9>3),
            SWITCH(C5,
            "2*","2* does not have OC 3.","3*","3* does not have OC 3.",
            "4*","OC 3 - Lv.1 to OC 3 - Lv.35","5*","OC 3 - Lv.1 to OC 3 - Lv.40",
            "6*","OC 3 - Lv.1 to OC 3 - Lv.40","OC 3 - Lv.x to OC 3 - Lv.x+"),
            IF(AND(C6<3,C9=3),
                SWITCH(C5,
                "2*","2* does not have OC 3.","3*","3* does not have OC 3.",
                "4*","OC 3 - Lv.1 to OC 3 - Lv."&C10,"5*","OC 3 - Lv.1 to OC 3 - Lv."&C10,
                "6*","OC 3 - Lv.1 to OC 3 - Lv."&C10,"OC 3 - Lv.x to OC 3 - Lv.x+"),
                IF(AND(C6=3,C9>3),
                    SWITCH(C5,
                    "2*","2* does not have OC 3.","3*","3* does not have OC 3.",
                    "4*","OC 3 - Lv."&C7&" to OC 3 - Lv.35","5*","OC 3 - Lv."&C7&" to OC 3 - Lv.40",
                    "6*","OC 3 - Lv."&C7&" to OC 3 - Lv.40","OC 3 - Lv.x to OC 3 - Lv.x+"),
                    SWITCH(C5,
                    "2*","2* does not have OC 3.","3*","3* does not have OC 3.",
                    "OC 3 - Lv.x to OC 3 - Lv.x+")))))
//Compressed version of above code.
=IF(AND(C6=3,C9=3),SWITCH(C5,"2*","2* does not have OC 3.","3*","3* does not have OC 3.","4*","OC 3 - Lv."&C7&" to OC 3 - Lv."&C10,"5*","OC 3 - Lv."&C7&" to OC 3 - Lv."&C10,"6*","OC 3 - Lv."&C7&" to OC 3 - Lv."&C10),IF(C6>3,SWITCH(C5,"2*","2* does not have OC 3.","3*","3* does not have OC 3.","OC 3 - Lv.x to OC 3 - Lv.x+"),IF(AND(C6<3,C9>3),SWITCH(C5,"2*","2* does not have OC 3.","3*","3* does not have OC 3.","4*","OC 3 - Lv.1 to OC 3 - Lv.35","5*","OC 3 - Lv.1 to OC 3 - Lv.40","6*","OC 3 - Lv.1 to OC 3 - Lv.40","OC 3 - Lv.x to OC 3 - Lv.x+"),IF(AND(C6<3,C9=3),SWITCH(C5,"2*","2* does not have OC 3.","3*","3* does not have OC 3.","4*","OC 3 - Lv.1 to OC 3 - Lv."&C10,"5*","OC 3 - Lv.1 to OC 3 - Lv."&C10,"6*","OC 3 - Lv.1 to OC 3 - Lv."&C10,"OC 3 - Lv.x to OC 3 - Lv.x+"),IF(AND(C6=3,C9>3),SWITCH(C5,"2*","2* does not have OC 3.","3*","3* does not have OC 3.","4*","OC 3 - Lv."&C7&" to OC 3 - Lv.35","5*","OC 3 - Lv."&C7&" to OC 3 - Lv.40","6*","OC 3 - Lv."&C7&" to OC 3 - Lv.40","OC 3 - Lv.x to OC 3 - Lv.x+"),SWITCH(C5,"2*","2* does not have OC 3.","3*","3* does not have OC 3.","OC 3 - Lv.x to OC 3 - Lv.x+"))))))

[OC Level 4 Label Code]
=IF(AND(C6=4,C9=4),
    SWITCH(C5,
    "2*","2* does not have OC 4.","3*","3* does not have OC 4.",
    "4*","4* does not have OC 4.","5*","OC 4 - Lv."&C7&" to OC 4 - Lv."&C10,
    "6*","OC 4 - Lv."&C7&" to OC 4 - Lv."&C10),
    IF(AND(C6<4,C9<4),
        SWITCH(C5,
        "2*","2* does not have OC 4.","3*","3* does not have OC 4.","4*","4* does not have OC 4.","OC 4 - Lv.x to OC 4 - Lv.x+"),
        IF(AND(C6<4,C9=4),
            SWITCH(C5,
            "2*","2* does not have OC 4.","3*","3* does not have OC 4.",
            "4*","4* does not have OC 4.","5*","OC 4 - Lv.1 to OC 4 - Lv"&C10,
            "6*","OC 4 - Lv.1 to OC 4 - Lv"&C10,"OC 4 - Lv.x to OC 4 - Lv.x+"),
            SWITCH(C5,
            "2*","2* does not have OC 4.","3*","3* does not have OC 4.",
            "4*","4* does not have OC 4.","OC 4 - Lv.x to OC 4 - Lv.x+")
            )))
//Compressed version of above code.
=IF(AND(C6=4,C9=4),SWITCH(C5,"2*","2* does not have OC 4.","3*","3* does not have OC 4.","4*","4* does not have OC 4.","5*","OC 4 - Lv."&C7&" to OC 4 - Lv."&C10,"6*","OC 4 - Lv."&C7&" to OC 4 - Lv."&C10),IF(AND(C6<4,C9<4),SWITCH(C5,"2*","2* does not have OC 4.","3*","3* does not have OC 4.","4*","4* does not have OC 4.","OC 4 - Lv.x to OC 4 - Lv.x+"),IF(AND(C6<4,C9=4),SWITCH(C5,"2*","2* does not have OC 4.","3*","3* does not have OC 4.","4*","4* does not have OC 4.","5*","OC 4 - Lv.1 to OC 4 - Lv"&C10,"6*","OC 4 - Lv.1 to OC 4 - Lv"&C10,"OC 4 - Lv.x to OC 4 - Lv.x+"),SWITCH(C5,"2*","2* does not have OC 4.","3*","3* does not have OC 4.","4*","4* does not have OC 4.","OC 4 - Lv.x to OC 4 - Lv.x+"))))

[[Link to the Project]]
https://docs.google.com/spreadsheets/d/1z1loqZI2J56A3esVIZq1Zb_S9vrDxyqvoun-gX05YbM/edit?usp=sharing
